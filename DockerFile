# Utilise l'image de base PHP (FastCGI Process Manager)
FROM php:8.2-fpm-alpine

# Installe les dépendances nécessaires et l'extension PostgreSQL (pdo_pgsql)
# Alpine est utilisé ici car l'image est plus légère.
RUN apk add --no-cache postgresql-client \
    && docker-php-ext-install pdo pdo_pgsql

# Configure le répertoire de travail
WORKDIR /app

# Copie le code de l'application dans le conteneur
COPY . /app

# Installe Composer (si non déjà dans l'image, ce qui est souvent le cas)
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Installe les dépendances PHP
RUN composer install --no-dev --optimize-autoloader

# Expose le port par défaut (Render utilisera $PORT mais c'est une bonne pratique)
EXPOSE 8080

# CRITIQUE : Définit la commande de démarrage (serveur PHP intégré)
# Le $PORT est automatiquement injecté par Render à l'exécution
CMD ["php", "-S", "0.0.0.0:8080", "-t", "public/"]
